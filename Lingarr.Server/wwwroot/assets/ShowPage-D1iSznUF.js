import{A as H,z as b,d as F,b as c,e as n,f as g,m as L,B as j,o as P,k as e,j as r,g as i,F as T,y as V,x as v,q as E,p as x,C as B,r as I,D as W,E as k,u as G,G as Q,c as U,S as R}from"./index-Ch4LkV9I.js";import{M as $}from"./index-ML11zQTX.js";import{u as q}from"./useDebounce--iKAfTly.js";import{C as Y,_ as J,a as K,b as X}from"./SortControls.vue_vue_type_script_setup_true_lang-DAR29HPR.js";import{a as D,L as O,_ as Z}from"./PageLayout.vue_vue_type_script_setup_true_lang-Brc2-CeY.js";import{C as ee}from"./CaretRightIcon-0y92JSx2.js";import{_ as te}from"./ReloadComponent.vue_vue_type_script_setup_true_lang-BiHkJTkN.js";import{_ as se,a as ae}from"./ContextMenu.vue_vue_type_script_setup_true_lang-B0hmnwW_.js";import{_ as N}from"./ToggleButton.vue_vue_type_script_setup_true_lang-BpuRAIPv.js";import{L as z}from"./LoaderCircleIcon--TJ8BGW4.js";import{_ as le}from"./InputComponent.vue_vue_type_script_setup_true_lang-B3DG7u6j.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TimesIcon-BnWx0jvB.js";import"./useClickOutside-CMGy5ibi.js";const A=H("show",{state:()=>({shows:{totalCount:0,pageSize:0,pageNumber:0,items:[]},filter:{searchQuery:"",sortBy:"Title",isAscending:!0,pageNumber:1}}),getters:{getFilter:d=>d.filter,get:d=>d.shows},actions:{async setFilter(d){this.filter=d.searchQuery?{...d,pageNumber:1}:d,await this.fetch()},async fetch(){this.shows=await b.media.shows(this.filter.pageNumber,this.filter.searchQuery,this.filter.sortBy,this.filter.isAscending)},async exclude(d,o){await b.media.exclude(d,o)},async updateThreshold(d,o,_){await b.media.threshold(d,o,_)},async priority(d,o){await b.media.priority(d,o)}}}),oe={class:"p-1"},M=F({__name:"CaretButton",props:{isExpanded:{type:Boolean}},setup(d){return(o,_)=>(n(),c("button",oe,[d.isExpanded?(n(),g(ee,{key:0,class:"h-4 w-4"})):(n(),g(Y,{key:1,class:"h-4 w-4"}))]))}}),ne={class:"bg-tertiary text-tertiary-content w-full"},ie={class:"border-primary grid grid-cols-12 border-b-2 font-bold"},re={class:"col-span-1 px-4 py-2"},de={class:"hidden lg:block"},ce={class:"col-span-7 px-4 py-2 md:col-span-5"},pe={class:"col-span-4 flex justify-between py-2 pr-4 md:col-span-5"},ue={class:"hidden md:block"},me={class:"col-span-1 px-4 py-2"},ge={class:"col-span-7 px-4 py-2 md:col-span-5"},ye={class:"col-span-4 flex justify-between pr-4 md:col-span-5"},fe={key:0,class:"flex flex-wrap items-center gap-2"},he={key:0,class:"text-primary-content/50"},xe={key:0,class:"text-amber-200/70 ml-1"},_e={key:1,class:"ml-1 text-xs opacity-70"},ve={key:2,class:"ml-1 text-xs opacity-70"},be={class:"col-span-1 px-1 py-2 md:col-span-1"},we=F({__name:"EpisodeTable",props:{episodes:{},subtitles:{}},setup(d){const{translate:o}=L(),_=d,y=A(),m=j({});P(async()=>{for(const a of _.episodes)if(!a.embeddedSubtitles||a.embeddedSubtitles.length===0)try{a.embeddedSubtitles=await b.subtitle.getEmbeddedSubtitles("episode",a.id)}catch{}});const f=a=>a?_.subtitles.filter(l=>l.fileName.toLocaleLowerCase().includes(a.toLocaleLowerCase())&&l.language&&l.language.trim()!=="").slice().sort((l,t)=>l.language.localeCompare(t.language)):null,w=a=>{if(!a.embeddedSubtitles)return[];const l=new Set((f(a.fileName??null)||[]).map(t=>t.language?.toLowerCase()));return a.embeddedSubtitles.filter(t=>{if(!t.isExtracted)return!0;const s=t.language?.toLowerCase();return!s||!l.has(s)})},C=a=>a.language?a.language.toUpperCase():`#${a.streamIndex}`,S=(a,l)=>a.length>l?a.substring(0,l)+"...":a,u=a=>a.isTextBased?a.isExtracted?"cursor-pointer text-green-300 border-green-500 bg-green-900/30":"cursor-pointer text-amber-300 border-amber-500 bg-amber-900/30":"cursor-not-allowed text-gray-400 border-gray-500 bg-gray-700/50 opacity-60",p=async(a,l)=>{if(!l.isTextBased){alert(o("embedded.imageBased"));return}if(l.isExtracted){alert(`${o("embedded.extracted")}: ${l.extractedPath}`);return}const t=`${a.id}-${l.streamIndex}`;if(!m[t])try{m[t]=!0;const s=await b.subtitle.extractSubtitle("episode",a.id,l.streamIndex);s.success?(l.isExtracted=!0,l.extractedPath=s.extractedPath,alert(o("embedded.extractSuccess"))):alert(`${o("embedded.extractFailed")}: ${s.error}`)}catch{alert(o("embedded.extractFailed"))}finally{m[t]=!1}};return(a,l)=>(n(),c("div",ne,[e("div",ie,[e("div",re,[e("span",de,r(i(o)("tvShows.episode")),1),l[0]||(l[0]=e("span",{class:"block lg:hidden"},"#",-1))]),e("div",ce,r(i(o)("tvShows.episodeTitle")),1),e("div",pe,[e("span",null,r(i(o)("tvShows.episodeSubtitles")),1),e("span",ue,r(i(o)("tvShows.exclude")),1),l[1]||(l[1]=e("span",{class:"block md:hidden"},"âŠ˜",-1))])]),(n(!0),c(T,null,V(d.episodes,t=>(n(),c("div",{key:t.id,class:"grid grid-cols-12"},[e("div",me,r(t.episodeNumber),1),e("div",ge,r(t.title),1),e("div",ye,[t?.fileName?(n(),c("div",fe,[(n(!0),c(T,null,V(f(t.fileName),(s,h)=>(n(),g(se,{key:`ext-${t.id}-${h}`,"media-type":i($).EPISODE,media:t,subtitle:s},{default:E(()=>[x(D,null,{default:E(()=>[B(r(s.language.toUpperCase())+" ",1),s.caption?(n(),c("span",he," - "+r(s.caption.toUpperCase()),1)):v("",!0)]),_:2},1024)]),_:2},1032,["media-type","media","subtitle"]))),128)),(n(!0),c(T,null,V(w(t),s=>(n(),c("div",{key:`emb-${t.id}-${s.id}`,class:"relative"},[x(D,{classes:u(s),onClick:h=>p(t,s)},{default:E(()=>[l[2]||(l[2]=e("span",{class:"mr-1"},"ðŸ“¦",-1)),B(" "+r(C(s))+" ",1),s.title?(n(),c("span",xe," ("+r(S(s.title,10))+") ",1)):v("",!0),s.isForced?(n(),c("span",_e,"F")):v("",!0),s.isDefault?(n(),c("span",ve,"D")):v("",!0),m[`${t.id}-${s.streamIndex}`]?(n(),g(z,{key:3,class:"ml-1 h-3 w-3 animate-spin"})):v("",!0)]),_:2},1032,["classes","onClick"])]))),128))])):v("",!0),e("div",be,[x(N,{modelValue:t.excludeFromTranslation,"onUpdate:modelValue":s=>t.excludeFromTranslation=s,size:"small","onToggle:update":()=>i(y).exclude(i($).EPISODE,t.id)},null,8,["modelValue","onUpdate:modelValue","onToggle:update"])])])]))),128))]))}}),Se={class:"bg-secondary p-4"},$e={class:"border-secondary bg-primary text-secondary-content grid grid-cols-12 border-b-2 font-bold"},ke={class:"col-span-6 px-4 py-2 md:col-span-3"},Ce={class:"col-span-4 flex justify-between px-4 py-2 md:col-span-6"},Te={class:"hidden md:block"},Ve={class:"col-span-2 px-4 py-2 text-center md:col-span-2"},Ee={class:"hidden md:block"},Ne=["onClick"],Fe={class:"col-span-6 flex items-center px-4 py-2 select-none md:col-span-3"},Ue={key:1,class:"w-7"},Be={key:2},Ie={key:3},Le={class:"col-span-4 flex justify-between px-4 py-2 select-none md:col-span-6"},je=["disabled","title","onClick"],ze=F({__name:"SeasonTable",props:{seasons:{}},setup(d){const{translate:o}=L(),_=A(),y=I([]),m=I(null),f=j({});async function w(u){if(u.episodes.length){if(m.value?.id===u.id){m.value=null;return}m.value=u,await C()}}async function C(){m.value?.path&&(y.value=await b.subtitle.collect(m.value.path))}const S=async u=>{f[u.id]=!0;try{const p=await b.translate.translateMedia(u.id,$.SEASON)}catch{}finally{f[u.id]=!1}};return(u,p)=>(n(),c("div",Se,[e("div",$e,[e("div",ke,r(i(o)("tvShows.season")),1),e("div",Ce,[e("span",null,r(i(o)("tvShows.episodes")),1),e("span",Te,r(i(o)("tvShows.exclude")),1),p[2]||(p[2]=e("span",{class:"block md:hidden"},"âŠ˜",-1))]),e("div",Ve,[e("span",Ee,r(i(o)("tvShows.translateNow")),1),p[3]||(p[3]=e("span",{class:"block md:hidden"},"âš¡",-1))]),p[4]||(p[4]=e("div",{class:"col-span-0 md:col-span-1"},null,-1))]),(n(!0),c(T,null,V(d.seasons,a=>(n(),c("div",{key:a.id,class:"bg-primary text-accent-content text-sm md:text-base"},[e("div",{class:W(["grid grid-cols-12",{"cursor-pointer":a.episodes.length}]),onClick:l=>w(a)},[e("div",Fe,[a.episodes.length?(n(),g(M,{key:0,"is-expanded":m.value?.id!==a.id,class:"pr-2"},null,8,["is-expanded"])):(n(),c("div",Ue)),a.seasonNumber==0?(n(),c("span",Be,r(i(o)("tvShows.specials")),1)):(n(),c("span",Ie,r(i(o)("tvShows.season"))+" "+r(a.seasonNumber),1))]),e("div",Le,[e("span",null,r(a.episodes.length)+" "+r(i(o)("tvShows.episodesLine")),1),e("span",{onClick:p[0]||(p[0]=k(()=>{},["stop"]))},[x(N,{modelValue:a.excludeFromTranslation,"onUpdate:modelValue":l=>a.excludeFromTranslation=l,size:"small","onToggle:update":()=>i(_).exclude(i($).SEASON,a.id)},null,8,["modelValue","onUpdate:modelValue","onToggle:update"])])]),e("div",{class:"col-span-2 flex items-center justify-center px-4 py-2 md:col-span-2",onClick:p[1]||(p[1]=k(()=>{},["stop"]))},[e("button",{class:"border-accent hover:bg-accent cursor-pointer rounded border p-1 transition-colors",disabled:f[a.id],title:i(o)("tvShows.translateNow"),onClick:l=>S(a)},[f[a.id]?(n(),g(z,{key:0,class:"h-4 w-4 animate-spin"})):(n(),g(O,{key:1,class:"h-4 w-4"}))],8,je)]),p[5]||(p[5]=e("div",{class:"col-span-0 md:col-span-1"},null,-1))],10,Ne),m.value?.id===a.id?(n(),g(we,{key:0,subtitles:y.value,episodes:a.episodes},null,8,["subtitles","episodes"])):v("",!0)]))),128))]))}}),Ae={key:0,class:"w-full"},De={class:"bg-tertiary flex flex-wrap items-center justify-between gap-2 p-4"},Pe={class:"flex w-full flex-col gap-2 md:w-fit md:flex-row md:justify-between md:space-x-2"},Oe={class:"w-full px-4"},Me={class:"border-accent grid grid-cols-12 border-b font-bold"},He={class:"col-span-6 px-4 py-2"},We={class:"col-span-1 px-4 py-2"},Ge={class:"hidden md:block"},Qe={class:"col-span-2 px-4 py-2"},Re={class:"col-span-1 px-4 py-2 text-center"},qe={class:"hidden md:block"},Ye={class:"col-span-1 px-4 py-2 text-center"},Je={class:"hidden md:block"},Ke={class:"col-span-1 flex justify-end px-4 py-2"},Xe=["onClick"],Ze={class:"col-span-6 flex items-center px-4 py-2"},et=["disabled","title","onClick"],yt=F({__name:"ShowPage",setup(d){const{translate:o}=L(),_=G(),y=A(),m=Q(),f=I(null),w=j({}),C=U(()=>m.getSetting(R.SONARR_SETTINGS_COMPLETED)),S=U(()=>y.get),u=U({get:()=>y.getFilter,set:q(l=>{y.setFilter(l)},300)});async function p(l){if(f.value===l.id){f.value=null;return}_.setPoster({content:l,type:"show"}),f.value=l.id}const a=async l=>{w[l.id]=!0;try{const t=await b.translate.translateMedia(l.id,$.SHOW)}catch{}finally{w[l.id]=!1}};return P(async()=>{await y.fetch()}),(l,t)=>(n(),g(Z,null,{default:E(()=>[C.value==="true"?(n(),c("div",Ae,[e("div",De,[x(J,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=s=>u.value=s)},null,8,["modelValue"]),e("div",Pe,[x(K,{modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=s=>u.value=s),options:[{label:i(o)("common.sortByTitle"),value:"Title"},{label:i(o)("common.sortByAdded"),value:"DateAdded"}]},null,8,["modelValue","options"])])]),e("div",Oe,[e("div",Me,[e("div",He,r(i(o)("tvShows.title")),1),e("div",We,[e("span",Ge,r(i(o)("tvShows.exclude")),1),t[8]||(t[8]=e("span",{class:"block md:hidden"},"âŠ˜",-1))]),e("div",Qe,r(i(o)("tvShows.ageThreshold")),1),e("div",Re,[e("span",qe,r(i(o)("tvShows.priority")),1),t[9]||(t[9]=e("span",{class:"block md:hidden"},"â˜…",-1))]),e("div",Ye,[e("span",Je,r(i(o)("tvShows.translateNow")),1),t[10]||(t[10]=e("span",{class:"block md:hidden"},"âš¡",-1))]),e("div",Ke,[x(te,{"onToggle:update":t[2]||(t[2]=s=>i(y).fetch())})])]),(n(!0),c(T,null,V(S.value.items,s=>(n(),c("div",{key:s.id},[e("div",{class:"border-accent grid cursor-pointer grid-cols-12 border-b",onClick:h=>p(s)},[e("div",Ze,[x(M,{"is-expanded":f.value!==s.id,class:"pr-2"},null,8,["is-expanded"]),B(" "+r(s.title),1)]),e("div",{class:"col-span-1 flex items-center px-4 py-2",onClick:t[3]||(t[3]=k(()=>{},["stop"]))},[x(N,{modelValue:s.excludeFromTranslation,"onUpdate:modelValue":h=>s.excludeFromTranslation=h,size:"small","onToggle:update":()=>i(y).exclude(i($).SHOW,s.id)},null,8,["modelValue","onUpdate:modelValue","onToggle:update"])]),e("div",{class:"col-span-2 flex items-center px-4 py-2",onClick:t[4]||(t[4]=k(()=>{},["stop"]))},[x(le,{"model-value":s.translationAgeThreshold??null,placeholder:i(o)("tvShows.hours"),class:"w-14",size:"sm",type:"number","validation-type":"number","onUpdate:value":h=>{s.translationAgeThreshold=h,i(y).updateThreshold(i($).SHOW,s.id,h)}},null,8,["model-value","placeholder","onUpdate:value"])]),e("div",{class:"col-span-1 flex items-center justify-center px-4 py-2",onClick:t[5]||(t[5]=k(()=>{},["stop"]))},[x(N,{modelValue:s.isPriority,"onUpdate:modelValue":h=>s.isPriority=h,size:"small","onToggle:update":()=>i(y).priority(i($).SHOW,s.id)},null,8,["modelValue","onUpdate:modelValue","onToggle:update"])]),e("div",{class:"col-span-1 flex items-center justify-center px-4 py-2",onClick:t[6]||(t[6]=k(()=>{},["stop"]))},[e("button",{class:"border-accent hover:bg-accent cursor-pointer rounded border p-1 transition-colors",disabled:w[s.id],title:i(o)("tvShows.translateNow"),onClick:h=>a(s)},[w[s.id]?(n(),g(z,{key:0,class:"h-4 w-4 animate-spin"})):(n(),g(O,{key:1,class:"h-4 w-4"}))],8,et)]),t[11]||(t[11]=e("div",{class:"col-span-1"},null,-1))],8,Xe),f.value===s.id?(n(),g(ze,{key:0,seasons:s.seasons},null,8,["seasons"])):v("",!0)]))),128))]),S.value.totalCount?(n(),g(X,{key:0,modelValue:u.value,"onUpdate:modelValue":t[7]||(t[7]=s=>u.value=s),"total-count":S.value.totalCount,"page-size":S.value.pageSize},null,8,["modelValue","total-count","page-size"])):v("",!0)])):(n(),g(ae,{key:1}))]),_:1}))}});export{yt as default};
