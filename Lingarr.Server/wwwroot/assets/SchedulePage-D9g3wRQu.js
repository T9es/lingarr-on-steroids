import{f as g}from"./date-BaQ8a7sT.js";import{A as w,z as l,b as c,e as r,k as e,d as y,r as x,f as m,N as J,c as k,o as S,a as E,p as f,g as u,j as t,F as C,y as N,C as v,x as b}from"./index-Ch4LkV9I.js";import{_ as R}from"./ReloadComponent.vue_vue_type_script_setup_true_lang-BiHkJTkN.js";import{L as T}from"./LoaderCircleIcon--TJ8BGW4.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{d as B}from"./delay-NRuupcPE.js";const L=w("schedule",{state:()=>({recurringJobs:[]}),getters:{getRecurringJobs:i=>i.recurringJobs},actions:{async fetchRecurringJobs(){this.recurringJobs=await l.schedule.recurringJobs()},async startJob(i){await l.schedule.startJob(i)},async indexShows(){await l.schedule.indexShows()},async indexMovies(){await l.schedule.indexMovies()}}}),P={},V={viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"};function M(i,n){return r(),c("svg",V,[...n[0]||(n[0]=[e("polygon",{points:"6 3 20 12 6 21 6 3"},null,-1)])])}const U=$(P,[["render",M]]),D=y({__name:"TriggerJob",emits:["toggle:trigger"],setup(i,{emit:n}){const p=n,a=x(!1),d=async()=>{a.value||(a.value=!0,p("toggle:trigger"),await B(1e3),a.value=!1)};return(s,h)=>(r(),c("div",{class:"cursor-pointer",onClick:d},[a.value?(r(),m(T,{key:0,class:"h-5 w-5 animate-spin"})):(r(),m(U,{key:1,class:"h-5 w-5"}))]))}}),F={class:"w-full"},I={class:"bg-tertiary flex flex-wrap items-center justify-end gap-2 p-4"},j={class:"w-full px-4"},z={class:"border-accent hidden border-b font-bold md:grid md:grid-cols-12"},A={class:"col-span-5 px-4 py-2"},G={class:"col-span-2 px-4 py-2"},q={class:"col-span-2 px-4 py-2"},H={class:"col-span-2 px-4 py-2"},K={class:"col-span-1 px-4 py-2"},O={class:"px-4 py-2 md:col-span-5"},Q={class:"font-bold md:hidden"},W={class:"px-4 py-2 md:col-span-2"},X={class:"font-bold md:hidden"},Y={class:"px-4 py-2 md:col-span-2"},Z={class:"font-bold md:hidden"},ee={key:0},se={class:"px-4 py-2 md:col-span-2"},te={class:"font-bold md:hidden"},oe={key:0},ne={class:"px-4 py-2 md:col-span-1"},ae={class:"font-bold md:hidden"},pe=y({__name:"SchedulePage",setup(i){const n=L(),p=J(),a=x(),d=k(()=>n.getRecurringJobs);return S(async()=>{await n.fetchRecurringJobs(),a.value=await p.connect("JobProgress","/signalr/JobProgress"),await a.value.joinGroup({group:"JobProgress"}),a.value.on("JobStateUpdated",(s,h)=>{const o=d.value.find(_=>_.id===s);o&&(o.currentState=h)})}),E(async()=>{a.value?.off("JobStateUpdated",()=>{})}),(s,h)=>(r(),c("div",F,[e("div",I,[f(R,{"onToggle:update":u(n).fetchRecurringJobs},null,8,["onToggle:update"])]),e("div",j,[e("div",z,[e("div",A,t(s.translate("schedule.jobName")),1),e("div",G,t(s.translate("schedule.state")),1),e("div",q,t(s.translate("schedule.lastExecution")),1),e("div",H,t(s.translate("schedule.nextExecution")),1),e("div",K,t(s.translate("schedule.actions")),1)]),(r(!0),c(C,null,N(d.value,o=>(r(),c("div",{key:o.id,class:"border-accent border-b md:grid md:grid-cols-12"},[e("div",O,[e("span",Q,t(s.translate("schedule.jobName"))+":  ",1),v(" "+t(o.id),1)]),e("div",W,[e("span",X,t(s.translate("schedule.state"))+":  ",1),v(" "+t(s.translate(`schedule.${o.currentState.toLowerCase()}`)),1)]),e("div",Y,[e("span",Z,t(s.translate("schedule.lastExecution"))+":  ",1),o.lastExecution?(r(),c("span",ee,t(u(g)(o.lastExecution)),1)):b("",!0)]),e("div",se,[e("span",te,t(s.translate("schedule.nextExecution"))+":  ",1),o.nextExecution?(r(),c("div",oe,t(u(g)(o.nextExecution)),1)):b("",!0)]),e("div",ne,[e("span",ae,t(s.translate("schedule.actions"))+":  ",1),f(D,{title:s.translate("schedule.run"),"onToggle:trigger":_=>u(n).startJob(o.id)},null,8,["title","onToggle:trigger"])])]))),128))])]))}});export{pe as default};
