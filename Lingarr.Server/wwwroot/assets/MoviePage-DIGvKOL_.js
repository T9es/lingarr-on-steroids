import{A as G,z as g,d as Q,m as R,G as q,u as Y,B as E,c as w,S as H,w as J,o as K,f as m,q as b,e as i,b as u,k as o,x as y,p,g as r,j as c,C as k,F as $,y as C,E as T}from"./index-Ch4LkV9I.js";import{M as v}from"./index-ML11zQTX.js";import{u as S}from"./useDebounce--iKAfTly.js";import{_ as W,a as X,b as Z}from"./SortControls.vue_vue_type_script_setup_true_lang-DAR29HPR.js";import{_ as ee,a as M,L as te}from"./PageLayout.vue_vue_type_script_setup_true_lang-Brc2-CeY.js";import{_ as se,a as ae}from"./ContextMenu.vue_vue_type_script_setup_true_lang-B0hmnwW_.js";import{_ as oe}from"./ReloadComponent.vue_vue_type_script_setup_true_lang-BiHkJTkN.js";import{_ as I}from"./ToggleButton.vue_vue_type_script_setup_true_lang-BpuRAIPv.js";import{_ as le}from"./InputComponent.vue_vue_type_script_setup_true_lang-B3DG7u6j.js";import{L as U}from"./LoaderCircleIcon--TJ8BGW4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TimesIcon-BnWx0jvB.js";import"./useClickOutside-CMGy5ibi.js";const re=G("movie",{state:()=>({movies:{totalCount:0,pageSize:0,pageNumber:0,items:[]},filter:{searchQuery:"",sortBy:"Title",isAscending:!0,pageNumber:1}}),getters:{getFilter:n=>n.filter,get(){return this.movies.items=this.movies.items?.map(n=>({...n,subtitles:n.subtitles?.slice().sort((l,d)=>l.language.localeCompare(d.language))})),this.movies}},actions:{async setFilter(n){this.filter=n.searchQuery?{...n,pageNumber:1}:n,await this.fetch()},async fetch(){this.movies=await g.media.movies(this.filter.pageNumber,this.filter.searchQuery,this.filter.sortBy,this.filter.isAscending)},async exclude(n,l){await g.media.exclude(n,l)},async updateThreshold(n,l,d){await g.media.threshold(n,l,d)},async priority(n,l){await g.media.priority(n,l)}}}),ie={key:0,class:"w-full"},ne={class:"bg-tertiary flex flex-wrap items-center justify-between gap-2 p-4"},de={class:"flex w-full flex-col gap-2 md:w-fit md:flex-row md:justify-between md:space-x-2"},ce={class:"w-full px-4"},ue={class:"border-accent grid grid-cols-12 border-b font-bold"},pe={class:"col-span-4 px-4 py-2"},me={class:"col-span-3 px-4 py-2"},ge={class:"col-span-1 px-4 py-2"},fe={class:"col-span-1 px-4 py-2 text-center"},ye={class:"hidden md:block"},xe={class:"col-span-1 px-4 py-2 text-center"},ve={class:"hidden md:block"},_e={class:"col-span-2 px-4 py-2"},he={class:"float-right"},be={class:"border-accent grid grid-cols-12 border-b"},we={class:"col-span-4 px-4 py-2"},ke={class:"col-span-3 flex flex-wrap items-center gap-2 px-4 py-2"},$e={key:0,class:"text-primary-content/50"},Ce={key:0,class:"text-amber-200/70 ml-1"},Te={key:1,class:"ml-1 text-xs opacity-70"},Ve={key:2,class:"ml-1 text-xs opacity-70"},Ee={class:"col-span-1 flex flex-wrap items-center gap-2 px-4 py-2"},Se=["disabled","title","onClick"],Qe=Q({__name:"MoviePage",setup(n){const{translate:l}=R(),d=re(),B=q(),N=Y(),_=E({}),h=E({}),F=w(()=>B.getSetting(H.RADARR_SETTINGS_COMPLETED)),x=w(()=>d.get),f=w({get:()=>d.getFilter,set:S(a=>{d.setFilter(a)},300)});J(()=>x.value.items,async a=>{if(a){for(const e of a)if(!e.embeddedSubtitles||e.embeddedSubtitles.length===0)try{e.embeddedSubtitles=await g.subtitle.getEmbeddedSubtitles("movie",e.id)}catch{}}},{immediate:!0});const A=S(async a=>{N.setPoster({content:a,type:"movie"})},1e3),L=async a=>{_[a.id]=!0;try{const e=await g.translate.translateMedia(a.id,v.MOVIE)}catch{}finally{_[a.id]=!1}},P=a=>{if(!a.embeddedSubtitles)return[];const e=new Set((a.subtitles||[]).map(t=>t.language?.toLowerCase()));return a.embeddedSubtitles.filter(t=>{if(!t.isExtracted)return!0;const s=t.language?.toLowerCase();return!s||!e.has(s)})},z=a=>a.language?a.language.toUpperCase():`#${a.streamIndex}`,D=(a,e)=>a.length>e?a.substring(0,e)+"...":a,O=a=>a.isTextBased?a.isExtracted?"cursor-pointer text-green-300 border-green-500 bg-green-900/30":"cursor-pointer text-amber-300 border-amber-500 bg-amber-900/30":"cursor-not-allowed text-gray-400 border-gray-500 bg-gray-700/50 opacity-60",j=async(a,e)=>{if(!e.isTextBased){alert(l("embedded.imageBased"));return}if(e.isExtracted){alert(`${l("embedded.extracted")}: ${e.extractedPath}`);return}const t=`${a.id}-${e.streamIndex}`;if(!h[t])try{h[t]=!0;const s=await g.subtitle.extractSubtitle("movie",a.id,e.streamIndex);s.success?(e.isExtracted=!0,e.extractedPath=s.extractedPath,alert(l("embedded.extractSuccess"))):alert(`${l("embedded.extractFailed")}: ${s.error}`)}catch{alert(l("embedded.extractFailed"))}finally{h[t]=!1}};return K(async()=>{await d.fetch()}),(a,e)=>(i(),m(ee,null,{default:b(()=>[F.value==="true"?(i(),u("div",ie,[o("div",ne,[p(W,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=t=>f.value=t)},null,8,["modelValue"]),o("div",de,[p(X,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=t=>f.value=t),options:[{label:r(l)("common.sortByTitle"),value:"Title"},{label:r(l)("common.sortByAdded"),value:"DateAdded"}]},null,8,["modelValue","options"])])]),o("div",ce,[o("div",ue,[o("div",pe,c(r(l)("movies.title")),1),o("div",me,c(r(l)("movies.subtitles")),1),o("div",ge,c(r(l)("movies.exclude")),1),o("div",fe,[o("span",ye,c(r(l)("movies.priority")),1),e[7]||(e[7]=o("span",{class:"block md:hidden"},"â˜…",-1))]),o("div",xe,[o("span",ve,c(r(l)("movies.translateNow")),1),e[8]||(e[8]=o("span",{class:"block md:hidden"},"âš¡",-1))]),o("div",_e,[k(c(r(l)("movies.ageThreshold"))+" ",1),o("span",he,[p(oe,{"onToggle:update":e[2]||(e[2]=t=>r(d).fetch())})])])]),(i(!0),u($,null,C(x.value.items,t=>(i(),u("div",{key:t.id},[o("div",be,[o("div",we,c(t.title),1),o("div",ke,[(i(!0),u($,null,C(t.subtitles,(s,V)=>(i(),m(se,{key:`ext-${V}-${s.fileName}`,subtitle:s,media:t,"media-type":r(v).MOVIE,"onUpdate:toggle":Me=>r(A)(t)},{default:b(()=>[p(M,null,{default:b(()=>[k(c(s.language.toUpperCase())+" ",1),s.caption?(i(),u("span",$e," - "+c(s.caption.toUpperCase()),1)):y("",!0)]),_:2},1024)]),_:2},1032,["subtitle","media","media-type","onUpdate:toggle"]))),128)),(i(!0),u($,null,C(P(t),s=>(i(),u("div",{key:`emb-${t.id}-${s.id}`,class:"relative"},[p(M,{classes:O(s),onClick:V=>j(t,s)},{default:b(()=>[e[9]||(e[9]=o("span",{class:"mr-1"},"ðŸ“¦",-1)),k(" "+c(z(s))+" ",1),s.title?(i(),u("span",Ce," ("+c(D(s.title,10))+") ",1)):y("",!0),s.isForced?(i(),u("span",Te,"F")):y("",!0),s.isDefault?(i(),u("span",Ve,"D")):y("",!0),h[`${t.id}-${s.streamIndex}`]?(i(),m(U,{key:3,class:"ml-1 h-3 w-3 animate-spin"})):y("",!0)]),_:2},1032,["classes","onClick"])]))),128))]),o("div",Ee,[p(I,{modelValue:t.excludeFromTranslation,"onUpdate:modelValue":s=>t.excludeFromTranslation=s,size:"small","onToggle:update":()=>r(d).exclude(r(v).MOVIE,t.id)},null,8,["modelValue","onUpdate:modelValue","onToggle:update"])]),o("div",{class:"col-span-1 flex items-center justify-center px-4 py-2",onClick:e[3]||(e[3]=T(()=>{},["stop"]))},[p(I,{modelValue:t.isPriority,"onUpdate:modelValue":s=>t.isPriority=s,size:"small","onToggle:update":()=>r(d).priority(r(v).MOVIE,t.id)},null,8,["modelValue","onUpdate:modelValue","onToggle:update"])]),o("div",{class:"col-span-1 flex items-center justify-center px-4 py-2",onClick:e[4]||(e[4]=T(()=>{},["stop"]))},[o("button",{class:"border-accent hover:bg-accent cursor-pointer rounded border p-1 transition-colors",disabled:_[t.id],title:r(l)("movies.translateNow"),onClick:s=>L(t)},[_[t.id]?(i(),m(U,{key:0,class:"h-4 w-4 animate-spin"})):(i(),m(te,{key:1,class:"h-4 w-4"}))],8,Se)]),o("div",{class:"col-span-2 flex items-center px-4 py-2",onClick:e[5]||(e[5]=T(()=>{},["stop"]))},[p(le,{"model-value":t?.translationAgeThreshold,placeholder:r(l)("movies.hours"),class:"w-14",size:"sm",type:"number","validation-type":"number","onUpdate:value":s=>{t.translationAgeThreshold=s,r(d).updateThreshold(r(v).MOVIE,t.id,s)}},null,8,["model-value","placeholder","onUpdate:value"])])])]))),128))]),x.value.totalCount?(i(),m(Z,{key:0,modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=t=>f.value=t),"total-count":x.value.totalCount,"page-size":x.value.pageSize},null,8,["modelValue","total-count","page-size"])):y("",!0)])):(i(),m(ae,{key:1}))]),_:1}))}});export{Qe as default};
